\input{../common.tex}

\newcommand{\headertext}{EE142 Problem Set 9}
\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

\title{\vspace{-0.4in}\Large \bf \headertext \vspace{-0.1in}}
\author{Vighnesh Iyer}

\date{\today}
\maketitle

\markboth{\headertext}{\headertext}
\thispagestyle{empty}

\section{Review of Important Concepts}
{\color{blue} Assume a memoryless distortion circuit is modeled by
$I_{out} = a_0 + a_1 V_{in} + a_2 V_{in}^2 + a_3 V_{in}^3$ and the input DC bias voltage is $V_{in,0}$.}

\begin{enumerate}[label=(\alph*)]
    \item {\color{blue} Derive IIP3, OIP3, $IP_{1dB}$, and $IP_{3dB}$}

    We begin by driving the circuit with a two-tone input with equal amplitude $A$ and frequencies $\omega_1$ and $\omega_2$:
    $$ S_i = A \cos{\left (\omega_1 t \right )} + A \cos{\left (\omega_2 t \right )} $$

    Now the full expanded form of the output can be derived:
    \begin{align*}
    S_o = \frac{9 a_{3}}{4} A^{3} \cos{\left (\omega_1 t \right )} + \frac{A^{3} a_{3}}{4} \cos{\left (3 \omega_1 t \right )} + \frac{9 a_{3}}{4} A^{3} \cos{\left (\omega_2 t \right )} + \frac{A^{3} a_{3}}{4} \cos{\left (3 \omega_2 t \right )} \\
        + \frac{3 a_{3}}{4} A^{3} \cos{\left (2 \omega_1 t + \omega_2 t \right )} + \frac{A^{2} a_{2}}{2} \cos{\left (2 \omega_1 t \right )} + \frac{A^{2} a_{2}}{2} \cos{\left (2 \omega_2 t \right )} + \\
        A^{2} a_{2} \cos{\left (\omega_1 t - \omega_2 t \right )} + A^{2} a_{2} \cos{\left (\omega_1 t + \omega_2 t \right )} + A^{2} a_{2} + A a_{1} \cos{\left (\omega_1 t \right )} + A a_{1} \cos{\left (\omega_2 t \right )}
    \end{align*}

    We define $IM3$ as $\frac{\text{Amplitude of one 3rd order IM product}}{\text{Amplitude of Fundamental}}$
    \begin{align*}
        IM3 &= \frac{3 a_3 / 4 \cdot A^3}{A a_1} \\
        &= \frac{3}{4} \frac{a_3}{a_1} A^2 \\
    \end{align*}

    To find IIP3, set $|IM3| = 1$ and solve for $A$. OIP3 is just the IIP3 power referenced to the output.
    \begin{align*}
        IIP3 &= \sqrt{\frac{4}{3} |\frac{a_1}{a_3}|} \\
        OIP3 &= IIP3 \cdot a_1
    \end{align*}

    $IP_{1dB}$ is defined by using a single-tone input and checking at what input power level the circuit's apparent gain has dropped by 1dB.

    \begin{align*}
        S_o = \frac{3 a_{3}}{4} A^{3} \cos{\left (\omega_1 t \right )} + \frac{A^{3} a_{3}}{4} \cos{\left (3 \omega_1 t \right )} &+ \frac{A^{2} a_{2}}{2} \cos{\left (2 \omega_1 t \right )} + \frac{A^{2} a_{2}}{2} + A a_{1} \cos{\left (\omega_1 t \right )} \\
        \text{Apparent Gain} &= \frac{a_1 A + \frac{3}{4} a_3 A^3}{A} \\
        &= a_1 (1 + \frac{3}{4} \frac{a_3}{a_1} A^2) \\
        20 \log(1 + \frac{3}{4} \frac{a_3}{a_1} A^2) &= -1 dB \\
        IP_{1dB} &= \sqrt{\frac{4}{3} |\frac{a_1}{a_3}|} \cdot \sqrt{0.11} \\
        IP_{3dB} &= \sqrt{\frac{4}{3} |\frac{a_1}{a_3}|} \cdot \sqrt{0.085}
    \end{align*}

    \item {\color{blue} If IIP3 is 10V, what is the input-blocker level that degrades the small-signal gain of the desired signal by 2dB?}

    We model an input signal $S_i = A \cos{\left (\omega_1 t \right )} + B \cos{\left (\omega_2 t \right )}$, where $\omega_1$ is the blocker, $\omega_2$ is the desired tone, and $A$ and $B$ are their magnitudes with $A >> B$.

    We want to look at the cubic terms in $S_o$, the output signal.
    \begin{align*}
        S_o \text{ contains }& \frac{3 a_{3}}{2} A^{2} B \cos{\left (\omega_2 t \right )} \\
        \text{Apparent Gain} &= \frac{a_1 B + a_3 \frac{3}{2} A^2 B}{B} \\
        &= a_1 (1 + \frac{3}{2} \frac{a_3}{a_1} A^2) \\
        &= a_1 (1 + \frac{2}{IIP3^2} A^2) \\
        20 \log(1 + \frac{2}{IIP3^2} A^2) &= -2 dB \\
        V_{blocker,max} &= 2.188 \text{ V}
    \end{align*}

    \item {\color{blue} Following part (b), what will be the tolerable blocker levels for a two-tone blocker?}

    We consider the following input signal: $ A \cos{\left (\omega_{d} t \right )} + B \cos{\left (\omega_{b1} t \right )} + B \cos{\left (\omega_{b2} t \right )} $

    Looking at the terms that contribute to $\omega_d$, we find the blocker term:
    \begin{align*}
        S_o \text{ contains } &= 3 A B^2 a_3
    \end{align*}
    this is just as expected since with two blocker tones, they will each contribute a blocking term to the desired signal.
    So, $V_{blocker,max} = 1.094 \text{ V}$

    \item {\color{blue} If IIP3 is 10V, what are the $IP_{1dB}$ for two-tone and three-tone input signals?}

    \begin{align*}
        IP_{1dB,one-tone} &= \sqrt{\frac{4}{3} |\frac{a_1}{a_3}|} \cdot \sqrt{0.11} = 3.32 \text{ V} \\
        IP_{1dB,two-tone} &= \sqrt{\frac{4}{9} |\frac{a_1}{a_3}|} \cdot \sqrt{0.11} = 1.9 \text{ V}\\
        IP_{1dB,three-tone} &= \sqrt{\frac{4}{15} |\frac{a_1}{a_3}|} \cdot \sqrt{0.11} = 1.48 \text{ V} \\
    \end{align*}

    \item {\color{blue} If the modeled circuit is a BJT with $I_{out} = I_s \exp(V_{be}/V_{T})$, use a math tool to find the actual output third-harmonic current as a function of the input magnitude. Compare the actual values to the estimated values via the power series.}

    I first thought of assigning $V_{be} = A \cdot \cos(2 \pi f t)$, and then finding the Fourier Series of $I_{out}$, but this turns out to be a non-elementary expression in terms of Bessel functions. I'm going to go with a numerical approach.


\end{enumerate}

\section{Distortion of a Source Follower}
{\color{blue} For the source follower shown below, calculate the required bias current ($I_{bias}$ and W/L for the long-channel transistor to drive the load with a swing of 100 mV (at both $f_1$ and $f_2$), with IM3 equal to -50 dBc.}

{\color{red} Correction: vout= 0.1cos(2pi*f1*t)+0.1cos(2pi*f2*t) vin magnitude is not specified}

\begin{figure}[H]
    \centering \includegraphics[width=0.8\textwidth]{problem2_schematic.jpg}
\end{figure}

\section{Pre-distortion and Source-degeneration Linearizer}
\begin{figure}[H]
    \centering \includegraphics[width=\textwidth]{problem3_schematic.jpg}
\end{figure}

\begin{enumerate}[label=(\alph*)]
    \item {\color{blue} For the above schematic, what are the OIP3 of the BJT stage for $R_e = 0 \Omega$ and $R_e = 0.02 \Omega$?}

    \item {\color{blue} What are the two possible $R_e$ for the BJT stage to have an OIP3 of 10A?}
\end{enumerate}

\end{document}
